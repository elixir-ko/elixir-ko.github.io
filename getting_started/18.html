<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>18 内包表記 - Comprehensions - Elixir</title>
  <link href="http://feeds.feedburner.com/ElixirLang" rel="alternate" title="Elixir's Blog" type="application/atom+xml" />
  <link rel="stylesheet" type="text/css" href="/css/style.css">
  <link rel="stylesheet" type="text/css" href="/css/syntax.css">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" id="font-bitter-css" href="http://fonts.googleapis.com/css?family=Bitter&amp;ver=1" type="text/css" media="screen">
</head>

<body class="getting_started">
  <div id="container">
    <div class="wrap">
    <div id="header">
      <div id="branding">
        <h1 id="site-title">
          <a href="/" title="Elixir" rel="Home">
            <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo" />
          </a>
        </h1>
      </div>

      <div id="menu-primary" class="menu-container">
        <div class="menu">
          <ul id="menu-primary-items">
            <li class="menu-item home"><a class="spec" href="/">Home</a></li>
            <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
            <li class="menu-item getting_started"><a class="spec" href="/getting_started/1.html">Getting Started</a></li>
            <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
            <li class="menu-item blog"><a class="spec" href="/blog">Blog</a></li>
            <li class="menu-item source"><a class="spec" href="https://github.com/elixir-lang/elixir">Source</a></li>
            <li class="menu-item packages"><a class="spec" href="http://hex.pm/">Packages</a></li>

          </ul>
        </div>
      </div>

      <div class="clear"></div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2014/09/18/elixir-v1-0-0-released/">Elixir v1.0.0 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="get" class="search-form" action="http://www.google.com/search">
		<div>
			<input class="search-text" type="text" name="q" placeholder="Search..." id="searchfield">
			<input type="hidden" name="sitesearch" value="elixir-lang.org">
			<input class="search-submit button" name="submit" type="submit" value="Search">
		</div>
	</form>
</div>

  <div class="widget">
    <h3 class="widget-title">Getting Started</h3>
    <ol>
      <li><a class="spec" href="/getting_started/1.html">Interactive Elixir (IEx)</a></li>
      <li><a class="spec" href="/getting_started/2.html">Basic types</a></li>
      <li><a class="spec" href="/getting_started/3.html">Basic operators</a></li>
      <li><a class="spec" href="/getting_started/4.html">Pattern matching</a></li>
      <li><a class="spec" href="/getting_started/5.html">case, cond and if</a></li>
      <li><a class="spec" href="/getting_started/6.html">Binaries, strings and char lists</a></li>
      <li><a class="spec" href="/getting_started/7.html">Keywords, maps and dicts</a></li>
      <li><a class="spec" href="/getting_started/8.html">Modules</a></li>
      <li><a class="spec" href="/getting_started/9.html">Recursion</a></li>
      <li><a class="spec" href="/getting_started/10.html">Enumerables and streams</a></li>
      <li><a class="spec" href="/getting_started/11.html">Processes</a></li>
      <li><a class="spec" href="/getting_started/12.html">IO</a></li>
      <li><a class="spec" href="/getting_started/13.html">alias, require and import</a></li>
      <li><a class="spec" href="/getting_started/14.html">Module attributes</a></li>
      <li><a class="spec" href="/getting_started/15.html">Structs</a></li>
      <li><a class="spec" href="/getting_started/16.html">Protocols</a></li>
      <li><a class="spec" href="/getting_started/17.html">try, catch and rescue</a></li>
      <li><a class="spec" href="/getting_started/18.html">Comprehensions</a></li>
      <li><a class="spec" href="/getting_started/19.html">Sigils</a></li>
      <li><a class="spec" href="/getting_started/20.html">Where to go next</a></li>
    </ol>
  </div>
  <div class="widget">
    <h3 class="widget-title">Mix and OTP</h3>
    <ol>
      <li><a class="spec" href="/getting_started/mix_otp/1.html">Introduction to Mix</a></li>
      <li><a class="spec" href="/getting_started/mix_otp/2.html">Agent</a></li>
      <li><a class="spec" href="/getting_started/mix_otp/3.html">GenServer</a></li>
      <li><a class="spec" href="/getting_started/mix_otp/4.html">GenEvent</a></li>
      <li><a class="spec" href="/getting_started/mix_otp/5.html">Supervisor and Application</a></li>
      <li><a class="spec" href="/getting_started/mix_otp/6.html">ETS</a></li>
      <li><a class="spec" href="/getting_started/mix_otp/7.html">Dependencies and umbrella apps</a></li>
      <li><a class="spec" href="/getting_started/mix_otp/8.html">Task and gen_tcp</a></li>
      <li><a class="spec" href="/getting_started/mix_otp/9.html">Docs, tests and pipelines</a></li>
      <li><a class="spec" href="/getting_started/mix_otp/10.html">Distributed tasks and configuration</a></li>
    </ol>
  </div>
  <div class="widget">
    <h3 class="widget-title">Meta-programming in Elixir</h3>
    <ol>
      <li><a class="spec" href="/getting_started/meta/1.html">Quote and unquote</a></li>
      <li><a class="spec" href="/getting_started/meta/2.html">Macros</a></li>
      <li><a class="spec" href="/getting_started/meta/3.html">Domain Specific Languages</a></li>
    </ol>
  </div>

  <div class="widget">
  <h3 class="widget-title">Learning resources</h3>
  <ul>
    <li class="image"><a href="http://pragprog.com/titles/elixir" title="Programming Elixir cover"><img src="http://imagery.pragprog.com/products/361/elixir_xlargebeta.jpg?1368724397" /></a></li>
    <li class="image"><a href="http://elixirsips.com" title="ElixirSips cover"><img src="http://elixirsips.com/images/ElixirLangAd2_190x160.png" width="190" height="160" /></a></li>
    <li class="image"><a href="http://manning.com/juric/" title="Elixir in Action"><img src="http://manning.com/juric/juric_cover150.jpg" width="190" height="238" /></a></li>
    <li class="image"><a href="http://www.exotpbook.com/" title="The Little Elixir and OTP Guidebook"><img src="http://i.imgur.com/G6icQmt.png" width="190" height="274" /></a></li>
    <li class="image"><a href="http://shop.oreilly.com/product/0636920030584.do" title="Introducing Elixir"><img src="http://akamaicovers.oreilly.com/images/0636920030584/rc_cat.gif" width="190" /></a></li>
  </ul>
</div>

  <div class="widget">
  <h3 class="widget-title">Code editor support</h3>
  <ul>
    <li><a class="spec" href="https://github.com/elixir-lang/emacs-elixir">Emacs Mode</a></li>
    <li><a class="spec" href="https://github.com/elixir-lang/elixir-tmbundle">Textmate Bundle</a></li>
    <li><a class="spec" href="https://github.com/elixir-lang/vim-elixir">Vim Elixir</a></li>
    <li><a class="spec" href="https://github.com/SteffenBauer/elixir-gtksourceview">GtkSourceView (gedit)</a></li>
    <li><a class="spec" href="https://github.com/lucasmazza/language-elixir">Atom Package</a></li>
  </ul>
</div>

  <div class="widget">
  <h3 class="widget-title">Sponsors</h3>
  <ul>
    <li class="image"><a href="http://plataformatec.com.br" title="Plataformatec"><img class="no-border" src="/images/logo/plataformatec.png" /></a></li>
  </ul>
</div>
</div>

<div id="content">
  <article>
    <h1 id="18-内包表記-comprehensions">18 内包表記 - Comprehensions</h1>

<p><div class="toc"></div></p>

<p>Elixirでは，列挙を繰り返すこと，結果をフィルタリングすること，そして別の値のリストへとマッピングすることをよく行います．内包表記はそうした構造の構文糖衣となっており，<code>for</code>というスペシャルフォームでそれらの一般的なタスクをまとめています．</p>

<p>In Elixir, it is common to loop over Enumerables, often filtering some results, and mapping to another list of values. Comprehensions are syntax sugar for such constructs, grouping those common tasks into the <code>for</code> special form.</p>

<p>例えば，以下のようにリストの要素の2乗を求めることができます:</p>

<p>For example, we can get all the square values of elements in a list as follows:</p>
<div class="highlight"><pre><code class="language-iex" data-lang="iex"><span class="gp">iex&gt; </span><span class="k">for</span> <span class="n">n</span> <span class="p">&lt;-</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="ss">do</span><span class="p">:</span> <span class="n">n</span> <span class="o">*</span> <span class="n">n</span>
<span class="go">[1, 4, 9, 16]</span>
</code></pre></div>
<p>リスト内包表記は3つの部品，生成器，フィルタ，収集品からできています．</p>

<p>A comprehension is made of three parts: generators, filters and collectables.</p>

<h2 id="18-1-生成器とフィルタ-generators-and-filters">18.1 生成器とフィルタ - Generators and filters</h2>

<p>上の式での<code>n &lt;- [1, 2, 3, 4]</code>が生成器です．これは文字通りリスト内包表記で使われる値を生成します．列挙可能なものなら何でも生成器の右側の式へ渡せます:</p>

<p>In the expression above, <code>n &lt;- [1, 2, 3, 4]</code> is the generator. It is literally generating values to be used in the comprehensions. Any enumerable can be passed in the right-hand side the generator expression:</p>
<div class="highlight"><pre><code class="language-iex" data-lang="iex"><span class="gp">iex&gt; </span><span class="k">for</span> <span class="n">n</span> <span class="p">&lt;-</span> <span class="mi">1</span><span class="p">..</span><span class="mi">4</span><span class="p">,</span> <span class="ss">do</span><span class="p">:</span> <span class="n">n</span> <span class="o">*</span> <span class="n">n</span>
<span class="go">[1, 4, 9, 16]</span>
</code></pre></div>
<p>生成器はパターンマッチングにも対応しており，マッチしなかった全てのパターンを無視します．範囲のかわりに，キーがアトムで<code>:good</code>か<code>:bad</code>となっているキーワードリストを持っていて，goodとなっているものの値だけを二乗したい場合を考えてみましょう:</p>

<p>Generator expressions also support pattern matching, ignoring all non-matching patterns. Imagine that instead of a range, we have a keyword list where the key is the atom <code>:good</code> or <code>:bad</code> and we only want to calculate the square of the good values:</p>
<div class="highlight"><pre><code class="language-iex" data-lang="iex"><span class="gp">iex&gt; </span><span class="n">values</span> <span class="p">=</span> <span class="p">[</span><span class="ss">good</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">good</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="ss">bad</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="ss">good</span><span class="p">:</span> <span class="mi">4</span><span class="p">]</span>
<span class="gp">iex&gt; </span><span class="k">for</span> <span class="p">{</span><span class="ss">:good</span><span class="p">,</span> <span class="n">n</span><span class="p">}</span> <span class="p">&lt;-</span> <span class="n">values</span><span class="p">,</span> <span class="ss">do</span><span class="p">:</span> <span class="n">n</span> <span class="o">*</span> <span class="n">n</span>
<span class="go">[1, 4, 16]</span>
</code></pre></div>
<p>代わりに，幾つか目的にあった要素だけを通すのにフィルターを利用することもできます．例えば奇数の二乗だけを入手できます:</p>

<p>Alternatively, filters can be used to filter some particular elements out. For example, we can get the square of only odd numbers:</p>
<div class="highlight"><pre><code class="language-iex" data-lang="iex"><span class="gp">iex&gt; </span><span class="kn">require</span> <span class="nc">Integer</span>
<span class="gp">iex&gt; </span><span class="k">for</span> <span class="n">n</span> <span class="p">&lt;-</span> <span class="mi">1</span><span class="p">..</span><span class="mi">4</span><span class="p">,</span> <span class="nc">Integer</span><span class="p">.</span><span class="n">is_odd</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="ss">do</span><span class="p">:</span> <span class="n">n</span> <span class="o">*</span> <span class="n">n</span>
<span class="go">[1, 9]</span>
</code></pre></div>
<p>フィルターは<code>nil</code>か<code>false</code>以外の全ての値を通します．</p>

<p>A filter will keep all values except <code>nil</code> or <code>false</code>.</p>

<p>一般的に内包表記は<code>Enum</code>や<code>Stream</code>モジュールにある同じ効果を持つ関数を使うより簡潔な表現を提供します．そのうえ，内包表記には複数の生成器とフィルターを与えることができます．ディレクトリのリストを受けとって，それらのディレクトリにある全てのファイルを削除する例がこちらです:</p>

<p>Comprehensions in general provide a much more concise representation than using the equivalent functions from the <code>Enum</code> and <code>Stream</code> modules. Furthermore, comprehensions also allow multiple generators and filters to be given. Here is an example that receives a list of directories and deletes all files in those directories:</p>
<div class="highlight"><pre><code class="language-elixir" data-lang="elixir"><span class="k">for</span> <span class="n">dir</span>  <span class="p">&lt;-</span> <span class="n">dirs</span><span class="p">,</span>
    <span class="n">file</span> <span class="p">&lt;-</span> <span class="nc">File</span><span class="p">.</span><span class="n">ls!</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span>
    <span class="n">path</span> <span class="p">=</span> <span class="nc">Path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span> <span class="n">file</span><span class="p">),</span>
    <span class="nc">File</span><span class="p">.</span><span class="n">regular?</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">do</span>
  <span class="nc">File</span><span class="p">.</span><span class="n">rm!</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>リスト内包表記の中の変数割り当てについて覚えておいてください．生成器，フィルター，あるいはブロックの内にあるものはリスト内包表記の外側には影響を及ぼしません．</p>

<p>Keep in mind that variable assignments inside the comprehension, be it in generators, filters or inside the block, are not reflected outside of the comprehension.</p>

<h2 id="18-2-bitstring生成器-bitstring-generators">18.2 Bitstring生成器 - Bitstring generators</h2>

<p>Bitstring生成器も使えます．bitstringのstreamを用意したいときにとても便利です．以下はそれぞれ赤，緑，青の値を表すピクセルのリストをバイナリで受け取ってタプルへと変換する例です:</p>

<p>Bitstring generators are also supported and are very useful when you need to organize bitstring streams. The example below receives a list of pixels from a binary with their respective red, green and blue values and convert them into triplets:</p>
<div class="highlight"><pre><code class="language-iex" data-lang="iex"><span class="gp">iex&gt; </span><span class="n">pixels</span> <span class="p">=</span> <span class="p">&lt;&lt;</span><span class="mi">213</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">132</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">234</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">15</span><span class="p">&gt;&gt;</span>
<span class="gp">iex&gt; </span><span class="k">for</span> <span class="p">&lt;&lt;</span><span class="n">r</span><span class="p">::</span><span class="mi">8</span><span class="p">,</span> <span class="n">g</span><span class="p">::</span><span class="mi">8</span><span class="p">,</span> <span class="n">b</span><span class="p">::</span><span class="mi">8</span> <span class="p">&lt;-</span> <span class="n">pixels</span><span class="p">&gt;&gt;,</span> <span class="ss">do</span><span class="p">:</span> <span class="p">{</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">}</span>
<span class="go">[{213,45,132},{64,76,32},{76,0,0},{234,32,15}]</span>
</code></pre></div>
<p>Bitstring生成器は&quot;普通の&quot;enumerable生成器と混ぜられ，フィルタもうまく動きます．</p>

<p>A bitstring generator can be mixed with the &quot;regular&quot; enumerable generators and provide filters as well.</p>

<h2 id="18-3-into-into">18.3 Into - Into</h2>

<p>上の例のように，内包表記は結果としてリストを返します．</p>

<p>In the examples above, the comprehension returned a list as a result.</p>

<p>しかし，<code>:into</code>オプションを渡すことで，内包表記の結果を異なるデータ型へと挿入することができます．例えば，全ての空白を簡単に削除するのにbitstring生成器と<code>:into</code>オプションを使うことができます:</p>

<p>However, the result of a comprehension can be inserted into different data structures by passing the <code>:into</code> option. For example, we can use bitstring generators with the <code>:into</code> option to easily remove all spaces in a string:</p>
<div class="highlight"><pre><code class="language-iex" data-lang="iex"><span class="gp">iex&gt; </span><span class="k">for</span> <span class="p">&lt;&lt;</span><span class="n">c</span> <span class="p">&lt;-</span> <span class="s2">&quot; hello world &quot;</span><span class="p">&gt;&gt;,</span> <span class="n">c</span> <span class="o">!=</span> <span class="sc">?</span><span class="se">\s</span><span class="p">,</span> <span class="ss">into</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="ss">do</span><span class="p">:</span> <span class="p">&lt;&lt;</span><span class="n">c</span><span class="p">&gt;&gt;</span>
<span class="go">&quot;helloworld&quot;</span>
</code></pre></div>
<p>セット，マップそして他のディクショナリも<code>:into</code>オプションに渡せます．たいていの場合，<code>:into</code>は<code>Collectable</code>プロトコルを実装してさえいればどんなものでも受けつけます．</p>

<p>Sets, maps and other dictionaries can also be given with the <code>:into</code> option. In general, the <code>:into</code> accepts any structure as long as it implements the <code>Collectable</code> protocol.</p>

<p>例えば<code>IO</code>モジュールはストリームを提供します．ストリームは<code>Enumerable</code>でかつ<code>Collectable</code>です．内包表記を使って何でもタイプしたものを大文字にして返すエコー端末を実装することができます:</p>

<p>For example, the <code>IO</code> module provides streams, that are both <code>Enumerable</code> and <code>Collectable</code>. You can implement an echo terminal that returns whatever is typed, but in upcase, using comprehensions:</p>
<div class="highlight"><pre><code class="language-iex" data-lang="iex"><span class="gp">iex&gt; </span><span class="n">stream</span> <span class="p">=</span> <span class="nc">IO</span><span class="p">.</span><span class="n">stream</span><span class="p">(</span><span class="ss">:stdio</span><span class="p">,</span> <span class="ss">:line</span><span class="p">)</span>
<span class="gp">iex&gt; </span><span class="k">for</span> <span class="n">line</span> <span class="p">&lt;-</span> <span class="n">stream</span><span class="p">,</span> <span class="ss">into</span><span class="p">:</span> <span class="n">stream</span> <span class="k">do</span>
<span class="gp">...&gt; </span>  <span class="nc">String</span><span class="p">.</span><span class="n">upcase</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&lt;&gt;</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="gp">...&gt; </span><span class="k">end</span>
</code></pre></div>
<p>ターミナルに何か文字を打つと同じ値が大文字になって表示されるのを見られるでしょう．不幸なことにこの例はシェルを内包表記にとじこめてしまいます，そこから出るには<code>Ctrl+C</code>を二回押さなければなりません．:)</p>

<p>Now type any string into the terminal and you will see the same value will be printed in upcase. Unfortunately, this example also got your shell stuck in the comprehension, so you will need to hit <code>Ctrl+C</code> twice to get out of it. :)</p>

  </article><!-- .hfeed -->

  
  <div class="pagination loop-pagination">
    
      <a href="17.html" class="previous page-numbers spec">&larr; Previous</a>
    
      <a class="page-numbers spec" href="#container">Top</a>
    
      <a href="19.html" class="next page-numbers spec">Next &rarr;</a>
    
  </div>
  
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear">
      </div>

      <div id="copyright">
        © 2012-2014 <a href="http://plataformatec.com.br/">Plataformatec</a>. All rights reserved.
      </p>
    </div><!-- .wrap -->
  </div><!-- #container -->

  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-8268430-6']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>

  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="/js/toc/toc.js" type="text/javascript" charset="utf-8"></script>
  <script type="text/javascript">
    $(document).ready(function() {
        $('.toc').toc({
          title: '',
          listType: 'ul',
          showSpeed: 0,
        });
    });
  </script>
</body>
</html>

